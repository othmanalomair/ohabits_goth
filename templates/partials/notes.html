{{ define "notes" }}
<div class="card notes">
    <h2>Daily Notes</h2>
    <form hx-post="/notes" hx-target=".notes" hx-swap="outerHTML" method="post" 
          onsubmit="this.querySelector('button').classList.add('saving'); return true;">
        <textarea name="text" placeholder="Write your note here...">
{{ .Notes.Text }}</textarea
        >
        <!-- If no note exists, use current date -->
        <input
            type="hidden"
            name="date"
            value="{{ if .Notes.Date.IsZero }}{{ now | formatDate }}{{ else }}{{ .Notes.Date | formatDate }}{{ end }}"
        />
        <button type="submit">
            <img
                src="/static/images/svg/save.svg"
                alt="Save Note"
                width="16"
                height="16"
            />
            Save Note
        </button>
    </form>
</div>

<script>
// Add animation after the notes template is loaded
document.addEventListener('DOMContentLoaded', function() {
    addNotesAnimation();
});

// Also add it when HTMX swaps content
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.target.classList.contains('notes')) {
        addNotesAnimation();
    }
});

function addNotesAnimation() {
    var notesContainer = document.querySelector('.notes');
    if (notesContainer && !notesContainer.hasAttribute('data-animated')) {
        notesContainer.setAttribute('data-animated', 'true');
        notesContainer.classList.add('flash-success');
        setTimeout(function() {
            notesContainer.classList.remove('flash-success');
        }, 800);
    }
}
</script>
{{ end }}
